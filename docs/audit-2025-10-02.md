# EmNet Site Security & Quality Audit – 2025-10-02

## Overview
- **Stack**: Static HTML, CSS, and vanilla JavaScript served without a build step.
- **Hosting**: GitHub Pages (custom domain via `CNAME`). No origin-level header control.
- **Source structure**: Shared stylesheet (`styles/main.css`) and a progressive-enhancement script (`assets/site.js`). No server-side logic.

## Key findings

| Severity | Finding | Evidence |
| --- | --- | --- |
| High | Inline scripts bypassed any meaningful CSP and allowed DOM execution if content were compromised. | `index.html` and companion pages appended `<script>document.querySelectorAll(...` (inline footer year helper). |
| Medium | No Content Security Policy, Referrer-Policy, sitemap, or disclosed security contact. | Absent `<meta http-equiv>` tags and `.well-known/security.txt` before the audit. |
| Low | Images missing intrinsic dimensions and lazy loading, risking layout shift and slower rendering. | `index.html` hero and divider images lacked `width`/`height` and `loading` attributes. |

## Remediation actions
- Added restrictive per-page CSP meta tags that only allow same-origin assets plus hashed structured-data blocks. (`index.html`, `about.html`, `services.html`, `how-we-work.html`, `privacy.html`)
- Moved the footer year helper into `assets/site.js` and removed all inline scripts.
- Declared `meta name="referrer"` for privacy-aware referrer handling.
- Added width/height/decoding hints and lazy-loading to non-critical images to reduce layout shift.
- Documented the security reporting process (`SECURITY.md`) and published `.well-known/security.txt`, `robots.txt`, and `sitemap.xml`.
- Created GitHub Actions CI (`.github/workflows/ci.yml`) running HTMLHint, Stylelint, ESLint, Linkinator, and Lighthouse smoke tests.

## Dependency review
- Introduced development dependencies for linting and smoke checks (`htmlhint`, `stylelint`, `eslint`, `linkinator`, `@lhci/cli`, `http-server`, `npm-run-all`, `stylelint-config-standard`).
- Network access to `npm` was unavailable in the sandbox, so `npm install`/`npm audit` could not be executed. Upstream maintainers should run `npm install` followed by `npm audit --production --audit-level=moderate` once networked to confirm no outstanding issues.

## Header & CSP strategy
- Added `<meta http-equiv="Content-Security-Policy">` to each page because GitHub Pages cannot set response headers.
- CSP allows `default-src 'self'`, blocks inline scripts except for whitelisted `sha256-…` hashes covering the structured-data block, and disallows frames (`frame-ancestors 'none'`).
- `meta name="referrer" content="strict-origin-when-cross-origin"` balances analytics with privacy.
- HSTS, Permissions-Policy, and other response headers remain unavailable without a CDN/reverse proxy; document this limitation in README.md.

## Lighthouse & accessibility
- Automated Lighthouse smoke test is configured through `lighthouserc.json` but not executed locally (npm fetch restricted in sandbox).
- Manual improvements: intrinsic image sizing, lazy loading, and `decoding="async"` for non-critical assets. Existing semantic landmarks and skip-targets already provided good accessibility coverage.

## Remaining risks & recommendations
1. **Response headers** – When feasible, place the site behind a CDN/reverse proxy and enforce HSTS (`max-age >= 31536000`), Permissions-Policy, and X-Content-Type-Options.
2. **Automated dependency checks** – Run `npm install` followed by `npm audit` in a networked environment to capture advisories as packages evolve.
3. **Lighthouse baseline** – Execute `npm run lhci:ci` locally once dependencies are installed to capture before/after scores and track regressions in CI.
4. **Cookie banner** – The banner currently sets a localStorage flag only. Decide whether analytics cookies will be introduced; if so, update the banner copy to detail specific storage.

